#!/bin/bash
source .env
SQL=".${INIT_DIR}/create-db.sql"

cat <<EOF > $SQL
#
# Generated by `basename "$0"` on `date`
#
USE $DB_NAME;
GRANT ALL PRIVILEGES ON $DB_NAME.* TO '$DB_USER'@'%';
#
# Create MySQL schema from generated data
# And load tables from generated csv data
#
EOF

# create send-receive table
curl -s "https://api.mockaroo.com/api/11161890?count=100&key=b45bad30" >> $SQL
# create webmail
curl -s "https://api.mockaroo.com/api/8a62a1c0?count=11&key=b45bad30" >> $SQL
# create dc-svc
curl -s "https://api.mockaroo.com/api/b0d1d6a0?count=190&key=b45bad30" >> $SQL
# sanitize table names
sed -i '' -E 's/(table|into) ([a-z]+-[a-z]+) /\1 \`\2` /g' $SQL
